<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checlikst - Checklist Automatizace</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; }
        header { background-color: #2c3e50; color: white; text-align: center; padding: 1em; }
        .container { max-width: 800px; margin: 2em auto; padding: 0 1em; }
        .checklist { background: white; padding: 2em; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .checklist h2 { color: #2c3e50; margin-bottom: 1em; }
        .checklist-item { display: flex; align-items: center; margin-bottom: 1em; }
        .checklist-item input[type="checkbox"] { margin-right: 1em; }
        .checklist-item label { font-size: 1.1em; }
        .completed { text-decoration: line-through; color: #888; }
        .delete-btn { margin-left: 1em; background-color: #e74c3c; color: white; border: none; padding: 0.3em 0.6em; border-radius: 3px; cursor: pointer; }
        .delete-btn:hover { background-color: #c0392b; }
        .add-task { margin-bottom: 1em; }
        .add-task input[type="text"] { padding: 0.5em; width: 70%; margin-right: 1em; }
        .add-task button { padding: 0.5em 1em; background-color: #2c3e50; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .add-task button:hover { background-color: #34495e; }
        @media (max-width: 600px) { .container { margin: 1em; } }
    </style>
</head>
<body>
    <header><h1>Checlikst</h1></header>
    <div class="container">
        <section class="checklist">
            <h2>Checklist projektu automatizace</h2>
            <div class="add-task">
                <input type="text" id="new-task" placeholder="Zadejte nový úkol">
                <button onclick="addTask()">Přidat úkol</button>
            </div>
            <div id="checklist-items">
                <div class="checklist-item"><input type="checkbox" id="task1"><label for="task1">Dodělat klavesnici na všech 16 kláves</label><button class="delete-btn" onclick="deleteTask('task1')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task2"><label for="task2">Dodělat komunikaci s klavesnicí a a esp32c3</label><button class="delete-btn" onclick="deleteTask('task2')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task3"><label for="task3">Dát python script do startup configu</label><button class="delete-btn" onclick="deleteTask('task3')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task4"><label for="task4">Dodělat kod pro esp 32c3 ohledně wheater station</label><button class="delete-btn" onclick="deleteTask('task4')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task5"><label for="task5">Připojit wheater station esp 01 na esp 32C3</label><button class="delete-btn" onclick="deleteTask('task5')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task6"><label for="task6">Udělat esp 01 pro ovládní světel</label><button class="delete-btn" onclick="deleteTask('task6')">Smazat</button></div>
                <div class="checklist-item"><input type="checkbox" id="task7"><label for="task7">Napojit esp01 light na esp 32c3</label><button class="delete-btn" onclick="deleteTask('task7')">Smazat</button></div>
            </div>
        </section>
    </div>

    <!-- Firebase modular SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove, push, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALhWs0vz-ZG84KWXXdF8CoMZu6b6zFuDQ",
            authDomain: "checklist-3aaa2.firebaseapp.com",
            databaseURL: "https://checklist-3aaa2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "checklist-3aaa2",
            storageBucket: "checklist-3aaa2.appspot.com",
            messagingSenderId: "315001625337",
            appId: "1:315001625337:web:10d787a6c1440437166028",
            measurementId: "G-CX7TCLZDN3"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Funkce pro přidání nového úkolu
        window.addTask = function() {
            const newTaskInput = document.getElementById('new-task');
            const taskText = newTaskInput.value.trim();
            if (taskText === '') return;

            const tasksRef = ref(database, 'checklist');
            const newTaskRef = push(tasksRef);
            const newTaskId = newTaskRef.key;

            set(newTaskRef, { text: taskText, checked: false });

            const checklistItems = document.getElementById('checklist-items');
            const newItem = document.createElement('div');
            newItem.className = 'checklist-item';
            newItem.innerHTML = `<input type="checkbox" id="${newTaskId}"><label for="${newTaskId}">${taskText}</label><button class="delete-btn" onclick="deleteTask('${newTaskId}')">Smazat</button>`;
            checklistItems.appendChild(newItem);

            newTaskInput.value = '';
            setupCheckbox(newTaskId);
        };

        // Funkce pro smazání úkolu
        window.deleteTask = function(taskId) {
            const taskRef = ref(database, 'checklist/' + taskId);
            remove(taskRef);
            const taskElement = document.getElementById(taskId).parentElement;
            taskElement.remove();
        };

        // Funkce pro nastavení checkboxu
        function setupCheckbox(taskId) {
            const checkbox = document.getElementById(taskId);
            const taskRef = ref(database, 'checklist/' + taskId);

            onValue(taskRef, snapshot => {
                const data = snapshot.val();
                if (data) {
                    checkbox.checked = data.checked || false;
                    const label = checkbox.nextElementSibling;
                    label.textContent = data.text;
                    if (data.checked) {
                        label.classList.add('completed');
                    } else {
                        label.classList.remove('completed');
                    }
                }
            });

            checkbox.addEventListener('change', function() {
                set(taskRef, { text: checkbox.nextElementSibling.textContent, checked: this.checked });
                if (this.checked) {
                    this.nextElementSibling.classList.add('completed');
                } else {
                    this.nextElementSibling.classList.remove('completed');
                }
            });
        }

        // Načtení všech úkolů při startu
        const tasksRef = ref(database, 'checklist');
        onValue(tasksRef, snapshot => {
            const checklistItems = document.getElementById('checklist-items');
            checklistItems.innerHTML = '';
            snapshot.forEach(childSnapshot => {
                const taskId = childSnapshot.key;
                const taskData = childSnapshot.val();
                const newItem = document.createElement('div');
                newItem.className = 'checklist-item';
                newItem.innerHTML = `<input type="checkbox" id="${taskId}"><label for="${taskId}">${taskData.text}</label><button class="delete-btn" onclick="deleteTask('${taskId}')">Smazat</button>`;
                checklistItems.appendChild(newItem);
                setupCheckbox(taskId);
            });
        });
    </script>
</body>
</html>
