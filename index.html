<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist - Automatizace</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; }
        header { background-color: #2c3e50; color: white; text-align: center; padding: 1em; }
        .container { max-width: 800px; margin: 2em auto; padding: 0 1em; }
        .checklist { background: white; padding: 2em; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .checklist h2 { color: #2c3e50; margin-bottom: 1em; }
        .checklist-item { display: flex; align-items: center; margin-bottom: 1em; }
        .checklist-item input[type="checkbox"] { margin-right: 1em; }
        .checklist-item label { font-size: 1.1em; }
        .completed { text-decoration: line-through; color: #888; }
        .delete-btn { margin-left: 1em; background-color: #e74c3c; color: white; border: none; padding: 0.3em 0.6em; border-radius: 3px; cursor: pointer; }
        .delete-btn:hover { background-color: #c0392b; }
        .add-task { margin-bottom: 1em; }
        .add-task input[type="text"] { padding: 0.5em; width: 70%; margin-right: 1em; }
        .add-task button { padding: 0.5em 1em; background-color: #2c3e50; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .add-task button:hover { background-color: #34495e; }
        .auth-btn { margin: 1em 0; padding: 0.5em 1em; border: none; border-radius: 3px; cursor: pointer; }
        .login { background-color: #27ae60; color: white; }
        .logout { background-color: #e67e22; color: white; }
        @media (max-width: 600px) { .container { margin: 1em; } }
    </style>
</head>
<body>
    <header><h1>Checklist</h1></header>
    <div class="container">
        <section class="checklist">
            <h2>Checklist projektu automatizace</h2>

            <!-- Přihlášení / Odhlášení -->
            <button id="login-btn" class="auth-btn login">Přihlásit se Google</button>
            <button id="logout-btn" class="auth-btn logout" style="display:none;">Odhlásit se</button>
            <p id="user-info"></p>

            <div class="add-task" style="display:none;" id="task-controls">
                <input type="text" id="new-task" placeholder="Zadejte nový úkol">
                <button onclick="addTask()">Přidat úkol</button>
            </div>
            <div id="checklist-items"></div>
        </section>
    </div>

    <!-- Firebase modular SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove, push } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyALhWs0vz-ZG84KWXXdF8CoMZu6b6zFuDQ",
            authDomain: "checklist-3aaa2.firebaseapp.com",
            databaseURL: "https://checklist-3aaa2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "checklist-3aaa2",
            storageBucket: "checklist-3aaa2.appspot.com",
            messagingSenderId: "315001625337",
            appId: "1:315001625337:web:10d787a6c1440437166028",
            measurementId: "G-CX7TCLZDN3"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const loginBtn = document.getElementById("login-btn");
        const logoutBtn = document.getElementById("logout-btn");
        const userInfo = document.getElementById("user-info");
        const taskControls = document.getElementById("task-controls");
        const checklistItems = document.getElementById("checklist-items");

        // Přihlášení
        loginBtn.onclick = () => {
            signInWithPopup(auth, provider).catch(err => alert("Chyba: " + err.message));
        };

        // Odhlášení
        logoutBtn.onclick = () => {
            signOut(auth);
        };

        // Stav uživatele
        onAuthStateChanged(auth, user => {
            if (user) {
                loginBtn.style.display = "none";
                logoutBtn.style.display = "inline-block";
                userInfo.textContent = "Přihlášen jako: " + user.displayName;
                taskControls.style.display = "block";
                loadTasks();
            } else {
                loginBtn.style.display = "inline-block";
                logoutBtn.style.display = "none";
                userInfo.textContent = "";
                taskControls.style.display = "none";
                checklistItems.innerHTML = "";
            }
        });

        // Přidání úkolu
        window.addTask = function() {
            const newTaskInput = document.getElementById('new-task');
            const taskText = newTaskInput.value.trim();
            if (taskText === '') return;

            const tasksRef = ref(database, 'checklist');
            const newTaskRef = push(tasksRef);
            const newTaskId = newTaskRef.key;

            set(newTaskRef, { text: taskText, checked: false });
            newTaskInput.value = '';
        };

        // Smazání úkolu
        window.deleteTask = function(taskId) {
            const taskRef = ref(database, 'checklist/' + taskId);
            remove(taskRef);
        };

        // Nastavení checkboxu
        function setupCheckbox(taskId) {
            const checkbox = document.getElementById(taskId);
            const taskRef = ref(database, 'checklist/' + taskId);

            checkbox.addEventListener('change', function() {
                set(taskRef, { text: checkbox.nextElementSibling.textContent, checked: this.checked });
            });
        }

        // Načtení úkolů
        function loadTasks() {
            const tasksRef = ref(database, 'checklist');
            onValue(tasksRef, snapshot => {
                checklistItems.innerHTML = '';
                snapshot.forEach(childSnapshot => {
                    const taskId = childSnapshot.key;
                    const taskData = childSnapshot.val();
                    const newItem = document.createElement('div');
                    newItem.className = 'checklist-item';
                    newItem.innerHTML = `<input type="checkbox" id="${taskId}" ${taskData.checked ? "checked" : ""}>
                                         <label for="${taskId}" class="${taskData.checked ? "completed" : ""}">${taskData.text}</label>
                                         <button class="delete-btn" onclick="deleteTask('${taskId}')">Smazat</button>`;
                    checklistItems.appendChild(newItem);
                    setupCheckbox(taskId);
                });
            });
        }
    </script>
</body>
</html>
